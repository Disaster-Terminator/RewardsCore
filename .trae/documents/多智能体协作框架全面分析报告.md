# 多智能体协作框架全面分析报告

> 分析日期：2026-02-23
> 分析范围：`.trae/` 目录下所有配置文件

---

## 一、框架架构总览

### 1.1 角色矩阵

| 角色 | 英文标识 | 核心职责 | GitHub MCP | Memory MCP | Playwright MCP |
|------|----------|----------|------------|------------|----------------|
| **Master Agent** | `solo coder` | 任务路由、PR管理、Git操作 | 读写 | 读写 | ❌ 无 |
| **dev-agent** | `dev-agent` | 业务代码编写与局部验证 | 只读 | 只读 | ❌ 无 |
| **test-agent** | `test-agent` | 全量测试与 E2E 验收 | ❌ 无 | 只读 | 全量 (33工具) |
| **docs-agent** | `docs-agent` | 文档同步与维护 | 只读 | 只读 | ❌ 无 |

### 1.2 三层控制流架构

```
┌─────────────────────────────────────────────────────────────────────┐
│                    第一层：全局 Rule（路由器与总线）                    │
│  ┌─────────────────────────────────────────────────────────────┐   │
│  │  project_rules.md                                            │   │
│  │  - 状态标签字典（4 种标签）                                     │   │
│  │  - 通信媒介定义（3 个文件）                                     │   │
│  │  - 身份判定规则                                               │   │
│  │  - AI 审查处理规则                                            │   │
│  └─────────────────────────────────────────────────────────────┘   │
└─────────────────────────────────────────────────────────────────────┘
                                    │
                                    ▼
┌─────────────────────────────────────────────────────────────────────┐
│                  第二层：子 Agent 配置（API 接口）                     │
│  ┌──────────────┐ ┌──────────────┐ ┌──────────────┐ ┌────────────┐ │
│  │  master.md   │ │ dev-agent.md │ │test-agent.md │ │docs-agent.md│ │
│  │              │ │              │ │              │ │            │ │
│  │ - Identity   │ │ - Identity   │ │ - Identity   │ │ - Identity │ │
│  │ - Permissions│ │ - Constraints│ │ - Constraints│ │- Constraints│ │
│  │ - Constraints│ │ - Execution  │ │ - Execution  │ │- Execution │ │
│  │ - Routing    │ │ - Routing    │ │ - Routing    │ │- Routing   │ │
│  └──────────────┘ └──────────────┘ └──────────────┘ └────────────┘ │
└─────────────────────────────────────────────────────────────────────┘
                                    │
                                    ▼
┌─────────────────────────────────────────────────────────────────────┐
│                  第三层：Skill 文件（执行引擎）                        │
│  ┌────────────────┐ ┌────────────────┐ ┌────────────────┐          │
│  │master-execution│ │ dev-execution  │ │test-execution  │          │
│  │                │ │                │ │                │          │
│  │ - 任务分发流程  │ │ - 局部验证     │ │ - 环境诊断     │          │
│  │ - 熔断器检查   │ │ - 禁止猜测     │ │ - 降级执行     │          │
│  │ - 微提交保护   │ │ - 阻塞协议     │ │ - 精简取证     │          │
│  └────────────────┘ └────────────────┘ └────────────────┘          │
│  ┌────────────────┐ ┌────────────────┐ ┌────────────────┐          │
│  │docs-execution  │ │master-recovery │ │ mcp-acceptance │          │
│  └────────────────┘ └────────────────┘ └────────────────┘          │
│  ┌────────────────┐ ┌────────────────┐                             │
│  │  pr-review     │ │ fetch-reviews  │                             │
│  └────────────────┘ └────────────────┘                             │
└─────────────────────────────────────────────────────────────────────┘
```

### 1.3 Skills 调用关系图

```
                        Master Agent
                             │
         ┌───────────────────┼───────────────────┐
         │                   │                   │
         ▼                   ▼                   ▼
   master-execution    mcp-acceptance      pr-review
         │                   │                   │
         │                   │                   ▼
         │                   │            fetch-reviews
         │                   │
    ┌────┴────┬────────┬─────┘
    ▼         ▼        ▼
dev-agent  test-agent  docs-agent
    │         │          │
    ▼         ▼          ▼
dev-exec  test-exec  docs-exec
    │         │
    │         ▼
    │   master-recovery
    │    (当 BLOCK 时)
    ▼
[BLOCK_NEED_MASTER]
```

---

## 二、状态机驱动机制

### 2.1 状态标签字典

| 标签 | 含义 | 触发者 | 响应动作 |
|------|------|--------|----------|
| `[REQ_DEV]` | 需要修改业务代码 | Master / test-agent | 唤醒 dev-agent |
| `[REQ_TEST]` | 需要执行测试验证 | Master / dev-agent | 唤醒 test-agent |
| `[REQ_DOCS]` | 需要同步文档 | Master / test-agent | 唤醒 docs-agent |
| `[BLOCK_NEED_MASTER]` | 子任务受阻，需移交决策 | 任意子 Agent | 移交 Master Agent |

### 2.2 状态转换图

```
                              ┌─────────────────┐
                              │   用户请求       │
                              └────────┬────────┘
                                       │
                                       ▼
                              ┌─────────────────┐
                              │  Master Agent   │
                              │  (任务路由)      │
                              └────────┬────────┘
                                       │
              ┌────────────────────────┼────────────────────────┐
              │                        │                        │
              ▼                        ▼                        ▼
     ┌─────────────────┐      ┌─────────────────┐      ┌─────────────────┐
     │   [REQ_DEV]     │      │   [REQ_TEST]    │      │   [REQ_DOCS]    │
     │   代码修改       │      │   测试验收       │      │   文档更新       │
     └────────┬────────┘      └────────┬────────┘      └────────┬────────┘
              │                        │                        │
              ▼                        ▼                        ▼
     ┌─────────────────┐      ┌─────────────────┐      ┌─────────────────┐
     │   dev-agent     │      │   test-agent    │      │   docs-agent    │
     │   修改代码       │      │   执行测试       │      │   更新文档       │
     └────────┬────────┘      └────────┬────────┘      └────────┬────────┘
              │                        │                        │
              │                        │                        │
              ▼                        ▼                        ▼
     ┌─────────────────┐      ┌─────────────────┐      ┌─────────────────┐
     │ [REQ_TEST]      │      │ 全部通过        │      │ 任务完成        │
     │ (修改完成)       │      │ [REQ_DOCS]      │      │ (无标签输出)    │
     └────────┬────────┘      └────────┬────────┘      └─────────────────┘
              │                        │                        │
              │                        │                        │
              │               ┌────────┴────────┐               │
              │               │                 │               │
              │               ▼                 ▼               │
              │      ┌─────────────────┐ ┌─────────────────┐    │
              │      │ 测试失败        │ │ 测试通过        │    │
              │      │ [REQ_DEV]       │ │ [REQ_DOCS]      │    │
              │      └────────┬────────┘ └────────┬────────┘    │
              │               │                   │             │
              └───────────────┘                   └─────────────┘
                              │
                              │ (任意阶段阻塞)
                              ▼
                     ┌─────────────────┐
                     │[BLOCK_NEED_MASTER]│
                     │  master-recovery │
                     └────────┬────────┘
                              │
              ┌───────────────┼───────────────┐
              │               │               │
              ▼               ▼               ▼
     ┌─────────────┐ ┌─────────────┐ ┌─────────────┐
     │missing_context│ │logic_unimp- │ │retry_exhausted│
     │ 嗅探重试     │ │lementable   │ │ 人工干预     │
     │             │ │ 停止任务     │ │             │
     └─────────────┘ └─────────────┘ └─────────────┘
```

### 2.3 通信媒介

| 文件 | 用途 | 写入者 | 读取者 | 覆写规则 |
|------|------|--------|--------|----------|
| `.trae/current_task.md` | 任务上下文 | Master Agent | 所有子 Agent | 每次任务分发时覆写 |
| `.trae/test_report.md` | 测试结果 | test-agent | Master Agent | 每次测试完成时覆写 |
| `.trae/blocked_reason.md` | 阻塞原因 | 任意 Agent | Master Agent | 每次阻塞时覆写 |

#### 媒介文件结构

**current_task.md**:
```yaml
---
task_id: <唯一ID>
created_at: <时间戳>
type: dev | test | docs
dev_retry_count: 0
max_retries: 3
status: pending | in_progress | completed | blocked
---

### 任务描述
<具体任务内容>

### 上下文信息
- 相关文件：<文件列表>
- 历史规则：<从 Memory MCP 检索的内容>

### 重试记录
| 轮次 | 时间 | 结果 | 备注 |
```

**test_report.md**:
```yaml
---
task_id: <任务ID>
status: pending | success | failed
created_at: <时间戳>
---

### 测试结果
- [ ] `ruff check` 通过
- [ ] `mypy` 通过
- 单元测试: X/Y 通过
- 集成测试: X/Y 通过
- 覆盖率: XX%
- E2E 验收: 待执行

### 精简取证（失败时填写）
```

**blocked_reason.md**:
```yaml
---
task_id: <任务ID>
agent: <Agent 名称>
created_at: <时间戳>
reason_type: missing_context | logic_unimplementable | mcp_failure | retry_exhausted
---

### 阻塞原因
<描述为什么无法继续执行>

### 需要的信息
- [ ] DOM 结构
- [ ] 日志
- [ ] 其他

### 已尝试的方案
1. <方案 1>
2. <方案 2>
3. <方案 3>
```

---

## 三、安全机制分析

### 3.1 熔断器规则（Circuit Breaker）

#### 重试计数机制

```yaml
# current_task.md 必须包含以下元数据
---
task_id: <唯一ID>
dev_retry_count: <当前重试次数，默认 0>
max_retries: <最大重试次数，默认 3>
---
```

#### 熔断触发条件

| 条件 | 动作 |
|------|------|
| `dev_retry_count < max_retries` | 允许路由，递增计数 |
| `dev_retry_count >= max_retries` | **禁止路由**，触发挂起，通知人类开发者 |

#### 熔断恢复流程

```
熔断触发
    │
    ▼
写入 blocked_reason.md (reason_type: retry_exhausted)
    │
    ▼
通知人类开发者
    │
    ├─► 继续任务：重置 dev_retry_count: 0，重新分发
    │
    └─► 放弃任务：清理媒介文件，结束任务
```

### 3.2 权限隔离

#### MCP 工具权限矩阵

| Agent | GitHub 读取 | GitHub 写入 | Memory 读取 | Memory 写入 | Playwright |
|-------|-------------|-------------|-------------|-------------|------------|
| Master | ✅ | ✅ | ✅ | ✅ | ❌ |
| dev-agent | ✅ | ❌ | ✅ | ❌ | ❌ |
| test-agent | ❌ | ❌ | ✅ | ❌ | ✅ (全量) |
| docs-agent | ✅ | ❌ | ✅ | ❌ | ❌ |

#### 文件编辑范围约束

| Agent | 允许编辑 | 禁止编辑 |
|-------|----------|----------|
| Master | 全部 | - |
| dev-agent | `src/` 等业务代码 | `tests/`、`*.md` |
| test-agent | `tests/` | `src/` 业务代码 |
| docs-agent | `*.md`、`docs/` | `src/`、`tests/` |

#### 禁止操作清单

| Agent | 禁止操作 |
|-------|----------|
| Master | 自行执行 E2E 测试、忽略 BLOCK 标签、熔断后继续路由、跳过微提交保护 |
| dev-agent | 使用 Playwright、写入 Memory、写入 GitHub、猜测 DOM 结构 |
| test-agent | 修改业务代码、猜测 DOM 结构、生成修复代码、提出修复建议、保存完整 HTML |
| docs-agent | 修改业务代码、修改测试代码、使用 Playwright |

### 3.3 微提交保护（Micro-Commits）

#### 触发时机

当收到 `[REQ_DEV]` 标签（测试失败需重写）时，必须在路由前执行保护操作。

#### 保护策略

| 策略 | 命令 | 适用场景 |
|------|------|----------|
| **git stash** | `git stash push -m "pre-fix state"` | 有未提交修改 |
| **WIP commit** | `git commit -m "WIP: pre-fix state before retry #N"` | 已暂存修改 |

#### 回滚能力

```bash
git stash pop  # 或
git reset --hard HEAD~1
```

---

## 四、工作流程分析

### 4.1 任务分发流程

```
用户请求
    │
    ▼
Master Agent 接收
    │
    ├─► 检索 Memory MCP 历史知识
    │
    ├─► 写入 current_task.md
    │
    └─► 根据任务类型输出标签
            │
            ├─► [REQ_DEV] → 检查熔断器 → 执行微提交保护 → 唤醒 dev-agent
            │
            ├─► [REQ_TEST] → 唤醒 test-agent
            │
            └─► [REQ_DOCS] → 检查触发条件 → 唤醒 docs-agent 或跳过
```

### 4.2 七阶段验收流程

| 阶段 | 内容 | 执行者 | 命令 |
|------|------|--------|------|
| 1 | 静态检查 | test-agent | `ruff check . && ruff format --check .` |
| 2 | 单元测试 | test-agent | `pytest tests/unit/ -m "not real" -v` |
| 3 | 集成测试 | test-agent | `pytest tests/integration/ -v` |
| 4 | Dev 无头验收 | test-agent | `rscore --dev --headless` (降级: `python main.py`) |
| 5 | User 无头验收 | test-agent | `rscore --user --headless` (降级: `python main.py`) |
| 6 | 创建 PR | Master Agent | `gh pr create` |
| 7 | 合并 PR | 人工确认 | 手动合并 |

#### 降级执行策略

```bash
# 步骤 1：尝试 rscore
rscore --dev --headless

# 步骤 2：如果 rscore 失败，降级到 python main.py
python main.py --dev --headless
```

| rscore 结果 | python main.py 结果 | 结论 |
|-------------|---------------------|------|
| ✅ 通过 | - | 正常 |
| ❌ 失败 | ✅ 通过 | rscore 入口问题 |
| ❌ 失败 | ❌ 失败 | 业务逻辑问题 |
| ❌ 不可用 | ✅ 通过 | rscore 未安装 |
| ❌ 不可用 | ❌ 失败 | 业务逻辑问题 |

### 4.3 AI 审查处理流程

#### AI 审查机器人

| 机器人 | 触发方式 | 可标记解决 | 解决状态检测 |
|--------|---------|-----------|-------------|
| Sourcery | `@sourcery-ai review` | ✅ 自动 | 检查 `body` 含 `✅ Addressed` |
| Copilot | 自动（PR 创建时） | ❌ | 无法判断，需人工处理 |
| Qodo | `/review` | ❌ | 无法判断，需人工处理 |

#### 审查处理流程

```
PR 创建
    │
    ▼
Copilot 自动审查 ──► Sourcery 触发 ──► Qodo 触发
    │                    │                 │
    └────────────────────┴─────────────────┘
                         │
                         ▼
                  fetch-reviews 获取评论
                         │
                         ▼
              ┌──────────┴──────────┐
              │                     │
         阻断问题              建议类问题
      (bug/security)         (suggestion)
              │                     │
              ▼                     ▼
        dev-agent 修复         自主决断
              │
              ▼
        重新触发审查
              │
              ▼
        通知人工合并
```

#### 审查问题分类

| 问题类型 | 来源 | 处理方式 |
|----------|------|----------|
| `bug_risk` | Sourcery | 必须修复 |
| `Bug` | Qodo | 必须修复 |
| `security` | 任意 | 必须修复 |
| `suggestion` | Copilot/Sourcery | 自主决断 |
| `performance` | 任意 | 自主决断 |

#### 合并限制

**重要限制**：项目要求合并前必须解决所有对话。

- **Sourcery**：自动检测 `✅ Addressed`
- **Copilot/Qodo**：无法通过 API 标记解决，需人工在 GitHub 网页点击"Resolve conversation"

**结论**：Agent 无法自主合并 PR，需人工确认。

---

## 五、设计亮点

### 5.1 权限隔离 ✅

**设计原则**：最小权限原则，每个 agent 只拥有完成任务所需的最小权限。

| Agent | 写入权限 | 设计理由 |
|-------|----------|----------|
| dev-agent | 仅文件编辑 | 禁止 GitHub/Memory 写入，防止误操作 |
| test-agent | 仅 tests/ 目录 | 禁止修改业务代码，禁止 GitHub 操作 |
| docs-agent | 仅 *.md 文件 | 禁止修改业务代码和测试代码 |
| Master Agent | 全部写入 | 作为协调者，负责 Git 操作和 PR 管理 |

**评价**：权限隔离设计合理，有效防止越权操作。

### 5.2 职责分离 ✅

```
代码修改 (dev-agent) ←→ 测试验收 (test-agent) ←→ 文档更新 (docs-agent)
         │                      │                      │
         └──────────────────────┴──────────────────────┘
                                │
                        Master Agent 协调
```

**评价**：职责边界清晰，避免角色混淆。

### 5.3 Skill 按需加载 ✅

提示词精简策略：
- Agent 提示词只保留核心约束（身份、权限、协议）
- 详细流程移到 skill 文件（按需加载）
- 降低上下文压力

| 指标 | 改动前 | 改动后 |
|------|--------|--------|
| 提示词字数 | ~3000 字 | ~500 字 |
| 上下文压力 | 高 | 低（按需加载） |

### 5.4 降级执行策略 ✅

```bash
rscore --dev --headless  # 优先
python main.py --dev --headless  # 降级
```

**评价**：降级策略确保验收流程的鲁棒性。

### 5.5 强制反推演机制 ✅

test-agent 的核心约束：
- **当** 发现代码有 Bug
- **则** 唯一合法动作是记录报错堆栈并退出
- **禁止** 生成修复代码片段
- **禁止** 提出修复建议
- **必须** 将决策权上交给 Master Agent

**评价**：防止 test-agent 越权修复，保持职责边界。

### 5.6 标准化阻断协议 ✅

所有子 Agent 的挂起机制：
- **当** 调用 MCP 连续 2 次失败
- **则** 必须立即触发 `[BLOCK_NEED_MASTER]` 标签
- **禁止** 继续重试
- **必须** 等待 Master Agent 介入

**评价**：防止无限重试，确保问题及时上报。

---

## 六、潜在问题与建议

### 6.1 Memory MCP 使用不足 ⚠️

**现状**：
- 所有子 agent 都禁止写入 Memory MCP
- 只有 Master Agent 有写入权限
- 但 Master Agent 的职责中 Memory 写入时机定义不够明确

**影响**：
- 历史知识积累不足
- 重复踩坑的可能性增加

**建议**：
1. 在 `master-execution` skill 中增加 Memory 写入时机说明
2. 明确 PR 合并后的知识归档流程
3. 考虑允许 dev-agent/test-agent 在特定场景下写入（如记录错误模式）

### 6.2 docs-agent 触发条件模糊 ⚠️

**现状**：
- 触发条件包括 "dev-agent 完成重大功能后（Master Agent 决策）"
- "重大功能" 定义不明确

**影响**：
- 文档更新可能被遗漏
- Master Agent 决策负担增加

**建议**：
1. 明确 "重大功能" 的判定标准：
   - 新增 `def` 或 `class`
   - 配置文件变更（`.env.example`、`config.yaml`）
   - API 接口变更
2. 或改为 PR 合并前自动触发

### 6.3 错误归因逻辑可细化 ⚠️

**现状**：
- test-agent 的错误归因逻辑已定义
- 但缺少具体的归因算法

**建议**：
增加更细化的归因规则：

| 错误特征 | 归因类型 | 自动处理 |
|----------|----------|----------|
| `TimeoutError: waiting for selector` | 测试脚本过期 | 自动修改 tests/ |
| `HTTP 500/502` | 服务端异常 | 输出 [REQ_DEV] |
| `ModuleNotFoundError` | 环境问题 | 返回错误报告 |
| `AssertionError` | 业务逻辑错误 | 输出 [REQ_DEV] |

### 6.4 Playwright 截图保存规范缺失 ⚠️

**现状**：
- test-agent 使用 Playwright 截图
- 但缺少截图保存路径规范

**建议**：
1. 截图保存到 `logs/screenshots/` 目录
2. 文件命名格式：`{task_id}_{timestamp}.png`
3. 在 test_report.md 中引用截图路径

### 6.5 熔断器重置流程不完整 ⚠️

**现状**：
- 熔断触发后需要人工干预
- 但缺少重置流程的详细说明

**建议**：
增加熔断重置流程：

```bash
# 人工重置命令
# 1. 编辑 current_task.md，重置 dev_retry_count: 0
# 2. 清空 blocked_reason.md
# 3. 重新分发任务
```

---

## 七、一致性检查结果

### 7.1 文件引用一致性 ✅

| 引用位置 | 被引用文件 | 状态 |
|----------|------------|------|
| master.md | master-execution skill | ✅ 存在 |
| master.md | master-recovery skill | ✅ 存在 |
| dev-agent.md | dev-execution skill | ✅ 存在 |
| test-agent.md | test-execution skill | ✅ 存在 |
| docs-agent.md | docs-execution skill | ✅ 存在 |
| mcp-acceptance | pr-review skill | ✅ 存在 |
| pr-review | fetch-reviews skill | ✅ 存在 |

### 7.2 MCP 工具配置一致性 ✅

| Agent | GitHub | Memory | Playwright |
|-------|--------|--------|------------|
| Master | 读写 | 读写 | 无 |
| dev-agent | 只读 | 只读 | 无 |
| test-agent | 无 | 只读 | 全量 |
| docs-agent | 只读 | 只读 | 无 |

**评价**：配置与提示词描述一致。

### 7.3 仓库信息一致性 ✅

| 文件 | owner | repo | branch |
|------|-------|------|--------|
| master.md | Disaster-Terminator | RewardsCore | main |
| fetch-reviews | Disaster-Terminator | RewardsCore | - |

**评价**：仓库信息一致。

### 7.4 术语使用一致性 ✅

| 术语 | 定义位置 | 使用位置 | 状态 |
|------|----------|----------|------|
| 状态标签 | project_rules.md | 所有 Agent | ✅ 一致 |
| 媒介文件 | project_rules.md | 所有 Agent | ✅ 一致 |
| 熔断器 | master.md | master-execution | ✅ 一致 |
| 微提交保护 | master.md | master-execution | ✅ 一致 |
| 精简取证 | test-agent.md | test-execution | ✅ 一致 |

---

## 八、总体评价与成熟度评估

### 8.1 优点总结

1. **架构清晰**：角色分工明确，职责边界清晰
2. **权限隔离**：最小权限原则，防止越权操作
3. **流程完整**：7 阶段验收覆盖全生命周期
4. **降级策略**：rscore → python main.py 确保鲁棒性
5. **Skill 体系**：按需加载，降低上下文压力
6. **状态机驱动**：标签路由机制清晰
7. **熔断器保护**：防止无限重试

### 8.2 待改进项

| 优先级 | 问题 | 建议 |
|--------|------|------|
| 高 | Memory MCP 使用不足 | 增加 Memory 写入时机说明 |
| 高 | docs-agent 触发条件模糊 | 明确"重大功能"判定标准 |
| 中 | 错误归因逻辑可细化 | 增加更细化的归因规则 |
| 中 | Playwright 截图保存规范缺失 | 增加截图保存路径规范 |
| 低 | 熔断器重置流程不完整 | 增加重置流程详细说明 |

### 8.3 成熟度评估

| 维度 | 评分 | 说明 |
|------|------|------|
| 架构设计 | ⭐⭐⭐⭐⭐ | 角色分工清晰，权限隔离合理 |
| 流程完整性 | ⭐⭐⭐⭐⭐ | 7 阶段验收覆盖全流程 |
| 文档一致性 | ⭐⭐⭐⭐⭐ | 文件引用、配置一致 |
| 错误处理 | ⭐⭐⭐⭐ | 基本完整，可优化 |
| 可扩展性 | ⭐⭐⭐⭐ | Skill 体系支持扩展 |
| 知识积累 | ⭐⭐⭐ | Memory MCP 使用不足 |

**总体评价**：框架设计成熟，可投入使用。建议完善 Memory MCP 使用规范和 docs-agent 触发条件。

---

## 九、后续优化建议

### 9.1 短期优化（1-2 周）

| 任务 | 优先级 | 预期效果 |
|------|--------|----------|
| 增加 Memory 写入时机说明 | 高 | 知识积累更完善 |
| 明确 docs-agent 触发条件 | 高 | 文档更新更及时 |
| 增加 Playwright 截图保存规范 | 中 | 调试效率提升 |

### 9.2 中期优化（1 个月）

| 任务 | 优先级 | 预期效果 |
|------|--------|----------|
| 细化错误归因逻辑 | 中 | 自动化程度提升 |
| 完善熔断器重置流程 | 中 | 恢复效率提升 |
| 增加 test-agent 自动修复测试脚本能力 | 低 | 减少人工干预 |

### 9.3 长期优化（持续）

| 任务 | 优先级 | 预期效果 |
|------|--------|----------|
| 根据实际使用情况调整 agent 职责 | 低 | 框架更贴合实际 |
| 扩展 skill 体系支持更多场景 | 低 | 覆盖更多开发场景 |
| 增加 agent 性能监控 | 低 | 优化执行效率 |

---

## 十、附录

### A. 状态标签快速参考

| 标签 | 输出者 | 接收者 | 场景 |
|------|--------|--------|------|
| `[REQ_DEV]` | Master, test-agent | dev-agent | 需要修改业务代码 |
| `[REQ_TEST]` | Master, dev-agent | test-agent | 需要执行测试验证 |
| `[REQ_DOCS]` | Master, test-agent | docs-agent | 需要同步文档 |
| `[BLOCK_NEED_MASTER]` | 任意子 Agent | Master Agent | 子任务受阻 |

### B. 阻塞原因类型快速参考

| reason_type | 含义 | 恢复策略 |
|-------------|------|----------|
| `missing_context` | 缺少 DOM 结构等上下文 | Master 调用 test-agent 嗅探，携新数据重试 |
| `logic_unimplementable` | 核心逻辑无法实现 | 停止流转，交出控制权给人类 |
| `mcp_failure` | MCP 调用连续失败 | Master 检查 MCP 配置，人工干预 |
| `retry_exhausted` | 重试次数耗尽（熔断触发） | 人工审查后决定是否继续 |

### C. AI 审查命令快速参考

| 机器人 | 命令 | 用途 |
|--------|------|------|
| Sourcery | `@sourcery-ai review` | 触发新审查 |
| Sourcery | `@sourcery-ai resolve` | 解决所有评论 |
| Sourcery | `@sourcery-ai dismiss` | 解除所有审查 |
| Qodo | `/review` | PR 审查 |
| Qodo | `/describe` | 生成 PR 描述 |
| Qodo | `/improve` | 代码改进建议 |

---

*报告完成于 2026-02-23*
