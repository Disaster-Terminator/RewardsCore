# MS Rewards Automator - æºç å…¨ç›˜å®¡æŸ¥æŠ¥å‘Š

**å®¡æŸ¥æ—¥æœŸ**: 2026-02-10  
**é¡¹ç›®ç‰ˆæœ¬**: v1.1  
**å®¡æŸ¥èŒƒå›´**: å®Œæ•´æºç ã€æ¶æ„è®¾è®¡ã€æµ‹è¯•è¦†ç›–ã€æ–‡æ¡£è´¨é‡

---

## ğŸ“‹ æ‰§è¡Œæ‘˜è¦

æœ¬æ¬¡å®¡æŸ¥å¯¹ MS Rewards Automator é¡¹ç›®è¿›è¡Œäº†å…¨é¢çš„æºç åˆ†æï¼Œæ¶µç›–æ¶æ„è®¾è®¡ã€ä»£ç è´¨é‡ã€æµ‹è¯•è¦†ç›–ã€å®‰å…¨æ€§å’Œå¯ç»´æŠ¤æ€§ç­‰å¤šä¸ªç»´åº¦ã€‚

**æ€»ä½“è¯„ä»·**: â­â­â­â­â˜† (4.2/5.0)

**æ ¸å¿ƒå‘ç°**:
- âœ… æ¶æ„è®¾è®¡æ¸…æ™°ï¼Œæ¨¡å—åŒ–ç¨‹åº¦é«˜
- âœ… åæ£€æµ‹æœºåˆ¶å®Œå–„ï¼Œå¤šå±‚é˜²æŠ¤
- âœ… æµ‹è¯•è¦†ç›–è¾ƒå¥½ï¼ŒåŒ…å«å•å…ƒã€é›†æˆã€å±æ€§æµ‹è¯•
- âš ï¸ éƒ¨åˆ†æ¨¡å—å­˜åœ¨ä»£ç é‡å¤
- âš ï¸ å¼‚å¸¸å¤„ç†å¯è¿›ä¸€æ­¥ä¼˜åŒ–
- âš ï¸ æ€§èƒ½ç›‘æ§éœ€è¦å¢å¼º

---

## ğŸ—ï¸ æ¶æ„åˆ†æ

### æ•´ä½“æ¶æ„è¯„åˆ†: â­â­â­â­â­ (5/5)


#### æ¶æ„ä¼˜åŠ¿

1. **æ¸…æ™°çš„åˆ†å±‚è®¾è®¡**
   ```
   main.py (å…¥å£å±‚)
     â†“
   æ ¸å¿ƒä¸šåŠ¡å±‚ (src/core/)
     â”œâ”€â”€ login/ (ç™»å½•çŠ¶æ€æœº)
     â”œâ”€â”€ search/ (æŸ¥è¯¢å¼•æ“)
     â””â”€â”€ tasks/ (ä»»åŠ¡ç³»ç»Ÿ)
     â†“
   åŸºç¡€è®¾æ–½å±‚ (src/)
     â”œâ”€â”€ browser_simulator.py (æµè§ˆå™¨ç®¡ç†)
     â”œâ”€â”€ anti_ban_module.py (åæ£€æµ‹)
     â””â”€â”€ health_monitor.py (å¥åº·ç›‘æ§)
   ```

2. **æ¨¡å—åŒ–è®¾è®¡**
   - æ¯ä¸ªæ¨¡å—èŒè´£å•ä¸€ï¼Œç¬¦åˆ SOLID åŸåˆ™
   - ä¾èµ–æ³¨å…¥é€šè¿‡ ConfigManager ç»Ÿä¸€ç®¡ç†
   - æ ¸å¿ƒæ¨¡å—ï¼ˆlogin/search/tasksï¼‰ç‹¬ç«‹å¯æµ‹è¯•

3. **çŠ¶æ€æœºæ¨¡å¼åº”ç”¨**
   - LoginStateMachine ä½¿ç”¨çŠ¶æ€æœºæ¨¡å¼å¤„ç†å¤æ‚ç™»å½•æµç¨‹
   - æ”¯æŒ 7 ç§ç™»å½•çŠ¶æ€ï¼Œè‡ªåŠ¨è½¬æ¢å’Œé™çº§
   - çŠ¶æ€å†å²è®°å½•ä¾¿äºè°ƒè¯•å’Œè¯Šæ–­

#### æ¶æ„å»ºè®®


1. **å¼•å…¥ä¾èµ–æ³¨å…¥å®¹å™¨**
   - å½“å‰é€šè¿‡æ‰‹åŠ¨ä¼ é€’ config å®ä¾‹ï¼Œå¯è€ƒè™‘ä½¿ç”¨ dependency-injector åº“
   - ä¾¿äºå•å…ƒæµ‹è¯•æ—¶ mock ä¾èµ–

2. **äº‹ä»¶é©±åŠ¨æ¶æ„**
   - è€ƒè™‘å¼•å…¥äº‹ä»¶æ€»çº¿ï¼ˆEvent Busï¼‰
   - è§£è€¦æ¨¡å—é—´çš„ç›´æ¥è°ƒç”¨å…³ç³»

---

## ğŸ’» ä»£ç è´¨é‡åˆ†æ

### ä»£ç è´¨é‡è¯„åˆ†: â­â­â­â­â˜† (4/5)

#### ä¼˜ç§€å®è·µ

1. **ç±»å‹æç¤ºå®Œå–„**
   ```python
   async def generate_queries(self, count: int, expand: bool = True) -> List[str]:
   ```
   - å¤§éƒ¨åˆ†å‡½æ•°éƒ½æœ‰ç±»å‹æç¤º
   - æé«˜ä»£ç å¯è¯»æ€§å’Œ IDE æ”¯æŒ

2. **æ–‡æ¡£å­—ç¬¦ä¸²è§„èŒƒ**
   ```python
   """
   Generate a list of unique search queries
   
   Args:
       count: Number of queries to generate
       expand: Whether to expand queries using Bing API
       
   Returns:
       List of unique query strings
   """
   ```


3. **æ—¥å¿—è®°å½•å®Œå–„**
   - ä½¿ç”¨æ ‡å‡† logging æ¨¡å—
   - æ—¥å¿—çº§åˆ«ä½¿ç”¨åˆç†ï¼ˆDEBUG/INFO/WARNING/ERRORï¼‰
   - å…³é”®æ“ä½œéƒ½æœ‰æ—¥å¿—è®°å½•

4. **é…ç½®ç®¡ç†ç»Ÿä¸€**
   - ConfigManager é›†ä¸­ç®¡ç†æ‰€æœ‰é…ç½®
   - æ”¯æŒåµŒå¥—é…ç½®è®¿é—®ï¼ˆå¦‚ `config.get("query_engine.cache_ttl")`ï¼‰
   - ConfigValidator è‡ªåŠ¨éªŒè¯å’Œä¿®å¤é…ç½®

#### ä»£ç é—®é¢˜

1. **ä»£ç é‡å¤** (ä¼˜å…ˆçº§: ä¸­)
   
   **ä½ç½®**: `search_engine.py` å’Œ `element_detector.py`
   
   **é—®é¢˜**: æœç´¢æ¡†é€‰æ‹©å™¨åˆ—è¡¨åœ¨ä¸¤å¤„é‡å¤å®šä¹‰
   ```python
   # search_engine.py (Line ~170)
   SEARCH_BOX_SELECTORS = [
       'input[name="q"]',
       '#sb_form_q',
       ...
   ]
   
   # element_detector.py (Line ~15)
   SEARCH_BOX_SELECTORS = [
       'input[name="q"]',
       ...
   ]
   ```
   
   **å»ºè®®**: æå–åˆ° `constants.py` æˆ–é…ç½®æ–‡ä»¶


2. **å¼‚å¸¸å¤„ç†è¿‡äºå®½æ³›** (ä¼˜å…ˆçº§: ä¸­)
   
   **ä½ç½®**: å¤šå¤„ä½¿ç”¨ `except Exception`
   
   **é—®é¢˜**: æ•è·æ‰€æœ‰å¼‚å¸¸å¯èƒ½éšè—çœŸå®é—®é¢˜
   ```python
   # browser_simulator.py
   except Exception as e:
       logger.error(f"åˆ›å»ºæµè§ˆå™¨å¤±è´¥: {e}")
   ```
   
   **å»ºè®®**: æ•è·å…·ä½“å¼‚å¸¸ç±»å‹
   ```python
   except (PlaywrightError, TimeoutError) as e:
       logger.error(f"åˆ›å»ºæµè§ˆå™¨å¤±è´¥: {e}")
   ```

3. **é­”æ³•æ•°å­—** (ä¼˜å…ˆçº§: ä½)
   
   **ä½ç½®**: `anti_ban_module.py`, `search_engine.py`
   
   **é—®é¢˜**: ç¡¬ç¼–ç çš„æ•°å­—ç¼ºä¹è¯­ä¹‰
   ```python
   scroll_distance = random.randint(200, 800)  # 200å’Œ800æ˜¯ä»€ä¹ˆï¼Ÿ
   await asyncio.sleep(0.1)  # 0.1ç§’çš„å«ä¹‰ï¼Ÿ
   ```
   
   **å»ºè®®**: å®šä¹‰å¸¸é‡
   ```python
   MIN_SCROLL_DISTANCE = 200  # æœ€å°æ»šåŠ¨è·ç¦»ï¼ˆåƒç´ ï¼‰
   MAX_SCROLL_DISTANCE = 800  # æœ€å¤§æ»šåŠ¨è·ç¦»ï¼ˆåƒç´ ï¼‰
   FOCUS_DELAY = 0.1  # èšç„¦åç­‰å¾…æ—¶é—´ï¼ˆç§’ï¼‰
   ```


4. **é•¿å‡½æ•°** (ä¼˜å…ˆçº§: ä½)
   
   **ä½ç½®**: `search_engine.py::perform_single_search()` (310è¡Œ)
   
   **é—®é¢˜**: å‡½æ•°è¿‡é•¿ï¼ŒèŒè´£è¿‡å¤š
   
   **å»ºè®®**: æ‹†åˆ†ä¸ºå¤šä¸ªå­å‡½æ•°
   ```python
   async def perform_single_search(self, page, term):
       await self._navigate_to_bing(page)
       await self._input_search_term(page, term)
       await self._submit_search(page)
       await self._interact_with_results(page)
   ```

---

## ğŸ›¡ï¸ å®‰å…¨æ€§åˆ†æ

### å®‰å…¨æ€§è¯„åˆ†: â­â­â­â­â˜† (4/5)

#### å®‰å…¨ä¼˜åŠ¿

1. **å‡­æ®ç®¡ç†**
   - å¯†ç ä¸ç¡¬ç¼–ç ï¼Œé€šè¿‡é…ç½®æ–‡ä»¶ç®¡ç†
   - storage_state.json åŠ å¯†å­˜å‚¨ä¼šè¯
   - é…ç½®æ–‡ä»¶åœ¨ .gitignore ä¸­æ’é™¤

2. **åæ£€æµ‹æœºåˆ¶å®Œå–„**
   - 8 å±‚ JavaScript åæ£€æµ‹è„šæœ¬
   - éšè— webdriver æ ‡å¿—
   - æ¨¡æ‹ŸçœŸå®ç”¨æˆ·è¡Œä¸ºï¼ˆæ»šåŠ¨ã€æ‰“å­—é€Ÿåº¦ï¼‰


3. **è¾“å…¥éªŒè¯**
   - ConfigValidator éªŒè¯é…ç½®é¡¹ç±»å‹å’ŒèŒƒå›´
   - é˜²æ­¢æ— æ•ˆé…ç½®å¯¼è‡´çš„å®‰å…¨é—®é¢˜

#### å®‰å…¨å»ºè®®

1. **æ•æ„Ÿä¿¡æ¯åŠ å¯†** (ä¼˜å…ˆçº§: é«˜)
   
   **é—®é¢˜**: `config.yaml` ä¸­çš„å¯†ç å’Œ token æ˜æ–‡å­˜å‚¨
   ```yaml
   login:
     credentials:
       email: ""
       password: ""  # æ˜æ–‡å¯†ç 
       totp_secret: ""  # æ˜æ–‡å¯†é’¥
   ```
   
   **å»ºè®®**: ä½¿ç”¨ç¯å¢ƒå˜é‡æˆ–å¯†é’¥ç®¡ç†å·¥å…·
   ```python
   import os
   from cryptography.fernet import Fernet
   
   password = os.getenv("MS_REWARDS_PASSWORD")
   # æˆ–ä½¿ç”¨åŠ å¯†å­˜å‚¨
   cipher = Fernet(key)
   encrypted_password = cipher.encrypt(password.encode())
   ```

2. **TOTP å¯†é’¥ä¿æŠ¤** (ä¼˜å…ˆçº§: é«˜)
   
   **å»ºè®®**: ä½¿ç”¨ç³»ç»Ÿå¯†é’¥é“¾ï¼ˆWindows Credential Manager / macOS Keychainï¼‰


3. **æ—¥å¿—è„±æ•** (ä¼˜å…ˆçº§: ä¸­)
   
   **é—®é¢˜**: æ—¥å¿—å¯èƒ½åŒ…å«æ•æ„Ÿä¿¡æ¯
   
   **å»ºè®®**: æ·»åŠ æ—¥å¿—è¿‡æ»¤å™¨
   ```python
   class SensitiveDataFilter(logging.Filter):
       def filter(self, record):
           record.msg = re.sub(r'password=\S+', 'password=***', record.msg)
           return True
   ```

---

## ğŸ§ª æµ‹è¯•è¦†ç›–åˆ†æ

### æµ‹è¯•è¦†ç›–è¯„åˆ†: â­â­â­â­â˜† (4/5)

#### æµ‹è¯•ç»“æ„

```
tests/
â”œâ”€â”€ unit/           # å•å…ƒæµ‹è¯• (20+ æ–‡ä»¶)
â”œâ”€â”€ integration/    # é›†æˆæµ‹è¯• (3 æ–‡ä»¶)
â”œâ”€â”€ properties/     # å±æ€§æµ‹è¯• (hypothesis)
â”œâ”€â”€ architecture/   # æ¶æ„æµ‹è¯•
â””â”€â”€ fixtures/       # æµ‹è¯•å¤¹å…·
```

#### æµ‹è¯•ä¼˜åŠ¿

1. **æµ‹è¯•ç±»å‹ä¸°å¯Œ**
   - å•å…ƒæµ‹è¯•ï¼šè¦†ç›–æ ¸å¿ƒæ¨¡å—
   - é›†æˆæµ‹è¯•ï¼šæµ‹è¯•æ¨¡å—é—´äº¤äº’
   - å±æ€§æµ‹è¯•ï¼šä½¿ç”¨ hypothesis è¿›è¡Œæ¨¡ç³Šæµ‹è¯•
   - P0 é›†æˆæµ‹è¯•ï¼šéªŒè¯å…³é”®åŠŸèƒ½


2. **æµ‹è¯•æ ‡è®°æ¸…æ™°**
   ```python
   @pytest.mark.unit
   @pytest.mark.integration
   @pytest.mark.property
   @pytest.mark.slow
   ```
   - ä¾¿äºé€‰æ‹©æ€§è¿è¡Œæµ‹è¯•
   - æ”¯æŒ CI/CD åˆ†å±‚æµ‹è¯•

3. **Mock ä½¿ç”¨åˆç†**
   - ä½¿ç”¨ AsyncMock æµ‹è¯•å¼‚æ­¥å‡½æ•°
   - éš”ç¦»å¤–éƒ¨ä¾èµ–ï¼ˆæµè§ˆå™¨ã€ç½‘ç»œï¼‰

4. **å±æ€§æµ‹è¯•è¦†ç›–**
   ```python
   @given(
       log_level=st.sampled_from(["DEBUG", "INFO", "WARNING"]),
       positive_integers=st.integers(min_value=1, max_value=100)
   )
   ```
   - ä½¿ç”¨ hypothesis è¿›è¡Œè¾¹ç•Œæµ‹è¯•
   - å‘ç°æ½œåœ¨çš„è¾¹ç•Œæ¡ä»¶é—®é¢˜

#### æµ‹è¯•ç¼ºé™·

1. **E2E æµ‹è¯•ç¼ºå¤±** (ä¼˜å…ˆçº§: é«˜)
   
   **é—®é¢˜**: `tests/e2e/` ç›®å½•ä¸ºç©º
   
   **å»ºè®®**: æ·»åŠ ç«¯åˆ°ç«¯æµ‹è¯•
   ```python
   @pytest.mark.e2e
   @pytest.mark.real
   async def test_full_workflow():
       """æµ‹è¯•å®Œæ•´çš„æœç´¢æµç¨‹"""
       # ç™»å½• â†’ æœç´¢ â†’ ä»»åŠ¡ â†’ ç§¯åˆ†æ£€æŸ¥
   ```


2. **æµ‹è¯•è¦†ç›–ç‡æœªé‡åŒ–** (ä¼˜å…ˆçº§: ä¸­)
   
   **é—®é¢˜**: æ²¡æœ‰ç”Ÿæˆè¦†ç›–ç‡æŠ¥å‘Š
   
   **å»ºè®®**: æ·»åŠ  pytest-cov é…ç½®
   ```ini
   # pytest.ini
   [pytest]
   addopts = --cov=src --cov-report=html --cov-report=term
   ```

3. **æ€§èƒ½æµ‹è¯•ä¸è¶³** (ä¼˜å…ˆçº§: ä¸­)
   
   **å»ºè®®**: æ·»åŠ æ€§èƒ½åŸºå‡†æµ‹è¯•
   ```python
   @pytest.mark.benchmark
   def test_query_generation_performance(benchmark):
       result = benchmark(query_engine.generate_queries, 100)
       assert len(result) == 100
   ```

---

## ğŸ“Š æ€§èƒ½åˆ†æ

### æ€§èƒ½è¯„åˆ†: â­â­â­â˜†â˜† (3.5/5)

#### æ€§èƒ½ä¼˜åŠ¿

1. **å¼‚æ­¥å¹¶å‘**
   - ä½¿ç”¨ asyncio å®ç°å¼‚æ­¥æ“ä½œ
   - å¤šæ•°æ®æºå¹¶å‘è·å–æŸ¥è¯¢
   ```python
   tasks = [source.fetch_queries(count) for source in self.sources]
   results = await asyncio.gather(*tasks)
   ```


2. **ç¼“å­˜æœºåˆ¶**
   - QueryCache ç¼“å­˜æŸ¥è¯¢ç»“æœï¼ˆTTL: 1å°æ—¶ï¼‰
   - å‡å°‘é‡å¤çš„ API è°ƒç”¨

3. **èµ„æºç®¡ç†**
   - BrowserSimulator ä¼˜é›…å…³é—­æµè§ˆå™¨
   - é˜²æ­¢å†…å­˜æ³„æ¼

#### æ€§èƒ½é—®é¢˜

1. **åŒæ­¥æœç´¢æ‰§è¡Œ** (ä¼˜å…ˆçº§: ä¸­)
   
   **é—®é¢˜**: æœç´¢ä»»åŠ¡ä¸²è¡Œæ‰§è¡Œ
   ```python
   for i in range(count):
       await perform_single_search(page, term)
       await asyncio.sleep(delay)  # ä¸²è¡Œç­‰å¾…
   ```
   
   **å»ºè®®**: è€ƒè™‘æ‰¹é‡é¢„åŠ è½½
   ```python
   # é¢„åŠ è½½å¤šä¸ªæœç´¢è¯
   terms = await self._get_search_terms(count)
   # æ‰¹é‡æ‰§è¡Œï¼ˆä¿æŒé—´éš”ï¼‰
   ```

2. **ç¼“å­˜ç­–ç•¥å•ä¸€** (ä¼˜å…ˆçº§: ä½)
   
   **é—®é¢˜**: åªæœ‰å†…å­˜ç¼“å­˜ï¼Œé‡å¯åä¸¢å¤±
   
   **å»ºè®®**: æ·»åŠ æŒä¹…åŒ–ç¼“å­˜
   ```python
   from diskcache import Cache
   cache = Cache('.cache')
   ```


3. **å¥åº·ç›‘æ§å¼€é”€** (ä¼˜å…ˆçº§: ä½)
   
   **é—®é¢˜**: å¥åº·æ£€æŸ¥æ¯ 30 ç§’æ‰§è¡Œä¸€æ¬¡ï¼Œå¯èƒ½å½±å“æ€§èƒ½
   
   **å»ºè®®**: åŠ¨æ€è°ƒæ•´æ£€æŸ¥é¢‘ç‡
   ```python
   # æ­£å¸¸æ—¶é™ä½é¢‘ç‡ï¼Œå¼‚å¸¸æ—¶æé«˜é¢‘ç‡
   interval = 60 if health_status == "healthy" else 30
   ```

---

## ğŸ“š æ–‡æ¡£è´¨é‡åˆ†æ

### æ–‡æ¡£è¯„åˆ†: â­â­â­â­â­ (5/5)

#### æ–‡æ¡£ä¼˜åŠ¿

1. **æ–‡æ¡£ç»“æ„å®Œå–„**
   ```
   docs/
   â”œâ”€â”€ guides/           # ç”¨æˆ·æŒ‡å—
   â”‚   â”œâ”€â”€ USAGE_GUIDE.md
   â”‚   â”œâ”€â”€ NOTIFICATION_GUIDE.md
   â”‚   â”œâ”€â”€ TROUBLESHOOTING.md
   â”‚   â”œâ”€â”€ QUERY_ENGINE_GUIDE.md
   â”‚   â””â”€â”€ TASK_SYSTEM_GUIDE.md
   â”œâ”€â”€ development/      # å¼€å‘è€…æ–‡æ¡£
   â”‚   â””â”€â”€ DEVELOPER_NOTES.md
   â””â”€â”€ reports/          # é¡¹ç›®æŠ¥å‘Š
   ```

2. **README è¯¦å°½**
   - åŠŸèƒ½ç‰¹æ€§æ¸…æ™°
   - å¿«é€Ÿå¼€å§‹æ­¥éª¤å®Œæ•´
   - é£é™©æç¤ºæ˜ç¡®
   - å¤šè¯­è¨€æ”¯æŒï¼ˆä¸­æ–‡ï¼‰


3. **ä»£ç æ³¨é‡Šå……åˆ†**
   - å…³é”®ç®—æ³•æœ‰è¯¦ç»†æ³¨é‡Š
   - å¤æ‚é€»è¾‘æœ‰è§£é‡Šè¯´æ˜

4. **é…ç½®æ–‡æ¡£å®Œå–„**
   - config.yaml åŒ…å«è¯¦ç»†çš„é…ç½®è¯´æ˜
   - æ¯ä¸ªé…ç½®é¡¹éƒ½æœ‰æ³¨é‡Š

#### æ–‡æ¡£å»ºè®®

1. **API æ–‡æ¡£ç”Ÿæˆ** (ä¼˜å…ˆçº§: ä½)
   
   **å»ºè®®**: ä½¿ç”¨ Sphinx ç”Ÿæˆ API æ–‡æ¡£
   ```bash
   pip install sphinx sphinx-rtd-theme
   sphinx-apidoc -o docs/api src/
   ```

2. **æ¶æ„å›¾** (ä¼˜å…ˆçº§: ä½)
   
   **å»ºè®®**: æ·»åŠ æ¶æ„å›¾å’Œæµç¨‹å›¾
   - ä½¿ç”¨ Mermaid æˆ– PlantUML
   - å¯è§†åŒ–æ¨¡å—å…³ç³»

---

## ğŸ” æ ¸å¿ƒæ¨¡å—æ·±åº¦åˆ†æ

### 1. ç™»å½•çŠ¶æ€æœº (LoginStateMachine)

**è¯„åˆ†**: â­â­â­â­â­ (5/5)

**ä¼˜åŠ¿**:
- çŠ¶æ€è½¬æ¢æ¸…æ™°ï¼Œæ”¯æŒ 7 ç§ç™»å½•çŠ¶æ€
- è‡ªåŠ¨æ£€æµ‹å’Œå¤„ç†å„ç§ç™»å½•åœºæ™¯
- çŠ¶æ€å†å²è®°å½•ä¾¿äºè°ƒè¯•


**è®¾è®¡æ¨¡å¼**:
```python
class LoginStateMachine:
    def __init__(self):
        self.handlers = {}  # çŠ¶æ€ â†’ å¤„ç†å™¨æ˜ å°„
        self.state_history = []  # çŠ¶æ€è½¬æ¢å†å²
    
    async def detect_state(self, page) -> LoginState:
        """æ£€æµ‹å½“å‰ç™»å½•çŠ¶æ€"""
        # æŒ‰ä¼˜å…ˆçº§æ£€æµ‹å„ç§çŠ¶æ€
    
    async def handle_login(self, page, credentials):
        """è‡ªåŠ¨å¤„ç†ç™»å½•æµç¨‹"""
        while not logged_in and transitions < max_transitions:
            current_state = await self.detect_state(page)
            handler = self.handlers[current_state]
            await handler.handle(page, credentials)
```

**å»ºè®®**:
- æ·»åŠ çŠ¶æ€è½¬æ¢è¶…æ—¶æœºåˆ¶ï¼ˆå·²å®ç°ï¼‰
- è€ƒè™‘æ·»åŠ çŠ¶æ€è½¬æ¢å¯è§†åŒ–å·¥å…·

### 2. æŸ¥è¯¢å¼•æ“ (QueryEngine)

**è¯„åˆ†**: â­â­â­â­â˜† (4/5)

**ä¼˜åŠ¿**:
- å¤šæ•°æ®æºèšåˆï¼ˆæœ¬åœ°æ–‡ä»¶ + Bing APIï¼‰
- æ™ºèƒ½å»é‡å’ŒéšæœºåŒ–
- ç¼“å­˜æœºåˆ¶å‡å°‘ API è°ƒç”¨

**æ¶æ„**:
```python
QueryEngine
  â”œâ”€â”€ QueryCache (TTLç¼“å­˜)
  â””â”€â”€ QuerySources
      â”œâ”€â”€ LocalFileSource
      â””â”€â”€ BingSuggestionsSource
```


**å»ºè®®**:
- æ·»åŠ æ›´å¤šæ•°æ®æºï¼ˆGoogle Trendsã€Wikipediaï¼‰
- å®ç°æŸ¥è¯¢è´¨é‡è¯„åˆ†æœºåˆ¶
- æ·»åŠ æŸ¥è¯¢åˆ†ç±»ï¼ˆæ–°é—»ã€ç§‘æŠ€ã€å¨±ä¹ç­‰ï¼‰

### 3. ä»»åŠ¡ç³»ç»Ÿ (TaskManager)

**è¯„åˆ†**: â­â­â­â­â˜† (4/5)

**ä¼˜åŠ¿**:
- æ’ä»¶åŒ–ä»»åŠ¡å¤„ç†å™¨è®¾è®¡
- æ”¯æŒ 3 ç§ä»»åŠ¡ç±»å‹ï¼ˆURLã€Quizã€Pollï¼‰
- ä»»åŠ¡æ‰§è¡ŒæŠ¥å‘Šè¯¦ç»†

**è®¾è®¡æ¨¡å¼**:
```python
class TaskManager:
    def __init__(self):
        self.task_registry = {}  # ä»»åŠ¡ç±»å‹ â†’ å¤„ç†å™¨ç±»
    
    def register_task_type(self, task_type, handler_class):
        """æ³¨å†Œæ–°çš„ä»»åŠ¡ç±»å‹"""
        self.task_registry[task_type] = handler_class
    
    async def execute_tasks(self, page, tasks):
        """æ‰¹é‡æ‰§è¡Œä»»åŠ¡"""
        for task in tasks:
            handler = self.task_registry[task.type]
            await handler.execute(page)
```

**å»ºè®®**:
- æ·»åŠ ä»»åŠ¡ä¼˜å…ˆçº§æœºåˆ¶
- å®ç°ä»»åŠ¡å¤±è´¥é‡è¯•ç­–ç•¥
- æ”¯æŒä»»åŠ¡å¹¶å‘æ‰§è¡Œï¼ˆéƒ¨åˆ†ä»»åŠ¡ï¼‰


### 4. åæ£€æµ‹æ¨¡å— (AntiBanModule)

**è¯„åˆ†**: â­â­â­â­â­ (5/5)

**ä¼˜åŠ¿**:
- 8 å±‚ JavaScript åæ£€æµ‹è„šæœ¬
- æ¨¡æ‹Ÿäººç±»è¡Œä¸ºï¼ˆæ»šåŠ¨ã€æ‰“å­—ã€é¼ æ ‡ç§»åŠ¨ï¼‰
- éšæœºåŒ–ç­–ç•¥ï¼ˆè§†å£å¤§å°ã€ç­‰å¾…æ—¶é—´ï¼‰

**åæ£€æµ‹ç­–ç•¥**:
```python
1. éšè— webdriver æ ‡å¿—
2. ä¿®æ”¹ navigator å±æ€§
3. è¦†ç›– permissions API
4. æ·»åŠ  chrome å¯¹è±¡
5. æ¨¡æ‹ŸçœŸå®è®¾å¤‡æŒ‡çº¹
6. éšæœºåŒ–ç”¨æˆ·è¡Œä¸º
7. åŠ æƒéšæœºç­‰å¾…æ—¶é—´
8. ç¼“åŠ¨æ»šåŠ¨æ•ˆæœ
```

**å»ºè®®**:
- æ·»åŠ  Canvas æŒ‡çº¹éšæœºåŒ–
- å®ç° WebGL æŒ‡çº¹ä¿æŠ¤
- æ·»åŠ å­—ä½“æŒ‡çº¹éšæœºåŒ–

### 5. å¥åº·ç›‘æ§ (HealthMonitor)

**è¯„åˆ†**: â­â­â­â­â˜† (4/5)

**ä¼˜åŠ¿**:
- å¤šç»´åº¦ç›‘æ§ï¼ˆç³»ç»Ÿã€ç½‘ç»œã€æ€§èƒ½ï¼‰
- è‡ªåŠ¨è¯Šæ–­å¸¸è§é—®é¢˜
- ç”Ÿæˆå¥åº·æŠ¥å‘Š


**ç›‘æ§æŒ‡æ ‡**:
```python
ç³»ç»Ÿå¥åº·:
  - CPU ä½¿ç”¨ç‡
  - å†…å­˜ä½¿ç”¨ç‡
  - ç£ç›˜ä½¿ç”¨ç‡

ç½‘ç»œå¥åº·:
  - Bing è¿é€šæ€§
  - Rewards è¿é€šæ€§
  - å“åº”æ—¶é—´

æ€§èƒ½æŒ‡æ ‡:
  - æœç´¢æˆåŠŸç‡
  - å¹³å‡å“åº”æ—¶é—´
  - æµè§ˆå™¨å´©æºƒæ¬¡æ•°
```

**å»ºè®®**:
- æ·»åŠ å‘Šè­¦é˜ˆå€¼é…ç½®
- å®ç°å‘Šè­¦é€šçŸ¥ï¼ˆé›†æˆ Notificatorï¼‰
- æ·»åŠ å†å²è¶‹åŠ¿åˆ†æ

---

## ğŸ› å·²çŸ¥é—®é¢˜æ±‡æ€»

### é«˜ä¼˜å…ˆçº§

1. **æ•æ„Ÿä¿¡æ¯åŠ å¯†**
   - ä½ç½®: `config.yaml`
   - å½±å“: å®‰å…¨æ€§
   - å»ºè®®: ä½¿ç”¨ç¯å¢ƒå˜é‡æˆ–å¯†é’¥ç®¡ç†å·¥å…·

2. **E2E æµ‹è¯•ç¼ºå¤±**
   - ä½ç½®: `tests/e2e/`
   - å½±å“: æµ‹è¯•è¦†ç›–
   - å»ºè®®: æ·»åŠ ç«¯åˆ°ç«¯æµ‹è¯•


### ä¸­ä¼˜å…ˆçº§

3. **ä»£ç é‡å¤**
   - ä½ç½®: `search_engine.py`, `element_detector.py`
   - å½±å“: å¯ç»´æŠ¤æ€§
   - å»ºè®®: æå–åˆ° `constants.py`

4. **å¼‚å¸¸å¤„ç†è¿‡äºå®½æ³›**
   - ä½ç½®: å¤šå¤„
   - å½±å“: è°ƒè¯•å›°éš¾
   - å»ºè®®: æ•è·å…·ä½“å¼‚å¸¸ç±»å‹

5. **æµ‹è¯•è¦†ç›–ç‡æœªé‡åŒ–**
   - ä½ç½®: æµ‹è¯•é…ç½®
   - å½±å“: è´¨é‡ä¿è¯
   - å»ºè®®: æ·»åŠ  pytest-cov

6. **åŒæ­¥æœç´¢æ‰§è¡Œ**
   - ä½ç½®: `search_engine.py`
   - å½±å“: æ€§èƒ½
   - å»ºè®®: æ‰¹é‡é¢„åŠ è½½

### ä½ä¼˜å…ˆçº§

7. **é­”æ³•æ•°å­—**
   - ä½ç½®: å¤šå¤„
   - å½±å“: å¯è¯»æ€§
   - å»ºè®®: å®šä¹‰å¸¸é‡

8. **é•¿å‡½æ•°**
   - ä½ç½®: `search_engine.py::perform_single_search()`
   - å½±å“: å¯ç»´æŠ¤æ€§
   - å»ºè®®: æ‹†åˆ†ä¸ºå­å‡½æ•°


9. **æ—¥å¿—è„±æ•**
   - ä½ç½®: æ—¥å¿—ç³»ç»Ÿ
   - å½±å“: å®‰å…¨æ€§
   - å»ºè®®: æ·»åŠ æ—¥å¿—è¿‡æ»¤å™¨

10. **ç¼“å­˜ç­–ç•¥å•ä¸€**
    - ä½ç½®: `QueryCache`
    - å½±å“: æ€§èƒ½
    - å»ºè®®: æ·»åŠ æŒä¹…åŒ–ç¼“å­˜

---

## ğŸ“ˆ æ”¹è¿›å»ºè®®è·¯çº¿å›¾

### çŸ­æœŸæ”¹è¿› (1-2å‘¨)

1. **æå–é‡å¤ä»£ç **
   - åˆ›å»º `src/constants.py`
   - ç»Ÿä¸€é€‰æ‹©å™¨å®šä¹‰
   - é¢„è®¡å·¥ä½œé‡: 2å°æ—¶

2. **ä¼˜åŒ–å¼‚å¸¸å¤„ç†**
   - æ›¿æ¢å®½æ³›çš„ `except Exception`
   - æ·»åŠ å…·ä½“å¼‚å¸¸ç±»å‹
   - é¢„è®¡å·¥ä½œé‡: 4å°æ—¶

3. **æ·»åŠ æµ‹è¯•è¦†ç›–ç‡æŠ¥å‘Š**
   - é…ç½® pytest-cov
   - ç”Ÿæˆ HTML æŠ¥å‘Š
   - é¢„è®¡å·¥ä½œé‡: 1å°æ—¶


### ä¸­æœŸæ”¹è¿› (2-4å‘¨)

4. **å®ç°æ•æ„Ÿä¿¡æ¯åŠ å¯†**
   - é›†æˆå¯†é’¥ç®¡ç†å·¥å…·
   - è¿ç§»é…ç½®åˆ°ç¯å¢ƒå˜é‡
   - é¢„è®¡å·¥ä½œé‡: 8å°æ—¶

5. **æ·»åŠ  E2E æµ‹è¯•**
   - ç¼–å†™ç«¯åˆ°ç«¯æµ‹è¯•ç”¨ä¾‹
   - é›†æˆåˆ° CI/CD
   - é¢„è®¡å·¥ä½œé‡: 16å°æ—¶

6. **ä¼˜åŒ–æ€§èƒ½**
   - å®ç°æ‰¹é‡é¢„åŠ è½½
   - æ·»åŠ æŒä¹…åŒ–ç¼“å­˜
   - é¢„è®¡å·¥ä½œé‡: 12å°æ—¶

7. **å¢å¼ºå¥åº·ç›‘æ§**
   - æ·»åŠ å‘Šè­¦é€šçŸ¥
   - å®ç°å†å²è¶‹åŠ¿åˆ†æ
   - é¢„è®¡å·¥ä½œé‡: 8å°æ—¶

### é•¿æœŸæ”¹è¿› (1-2æœˆ)

8. **å¼•å…¥ä¾èµ–æ³¨å…¥å®¹å™¨**
   - é›†æˆ dependency-injector
   - é‡æ„æ¨¡å—ä¾èµ–å…³ç³»
   - é¢„è®¡å·¥ä½œé‡: 24å°æ—¶

9. **å®ç°äº‹ä»¶é©±åŠ¨æ¶æ„**
   - è®¾è®¡äº‹ä»¶æ€»çº¿
   - è§£è€¦æ¨¡å—é—´è°ƒç”¨
   - é¢„è®¡å·¥ä½œé‡: 32å°æ—¶


10. **å¢å¼ºåæ£€æµ‹èƒ½åŠ›**
    - Canvas æŒ‡çº¹éšæœºåŒ–
    - WebGL æŒ‡çº¹ä¿æŠ¤
    - å­—ä½“æŒ‡çº¹éšæœºåŒ–
    - é¢„è®¡å·¥ä½œé‡: 16å°æ—¶

---

## ğŸ¯ æœ€ä½³å®è·µäº®ç‚¹

### 1. é…ç½®éªŒè¯å™¨

**ä½ç½®**: `src/config_validator.py`

**äº®ç‚¹**: å¯åŠ¨æ—¶è‡ªåŠ¨éªŒè¯å’Œä¿®å¤é…ç½®
```python
validator = ConfigValidator(config)
is_valid, errors, warnings = validator.validate_config(config.config)

if not is_valid:
    # å°è¯•è‡ªåŠ¨ä¿®å¤
    fixed_config = validator.fix_common_issues(config.config)
```

**ä»·å€¼**:
- é˜²æ­¢æ— æ•ˆé…ç½®å¯¼è‡´è¿è¡Œæ—¶é”™è¯¯
- æä¾›æ¸…æ™°çš„é”™è¯¯ä¿¡æ¯
- è‡ªåŠ¨ä¿®å¤å¸¸è§é—®é¢˜

### 2. å…ƒç´ æ£€æµ‹å™¨

**ä½ç½®**: `src/element_detector.py`

**äº®ç‚¹**: 11 ç§é€‰æ‹©å™¨çº§è”é™çº§
```python
SEARCH_BOX_SELECTORS = [
    'input[name="q"]',
    '#sb_form_q',
    'input[type="search"]',
    ...  # 11ç§é€‰æ‹©å™¨
]
```


**ä»·å€¼**:
- åº”å¯¹ Bing é¡µé¢é¢‘ç¹å˜åŒ–
- æé«˜æœç´¢æ¡†å®šä½æˆåŠŸç‡
- å¤±è´¥æ—¶è‡ªåŠ¨æˆªå›¾è¯Šæ–­

### 3. é˜²ç„¦ç‚¹æœºåˆ¶

**ä½ç½®**: `src/browser_simulator.py`, `src/anti_focus_scripts.py`

**äº®ç‚¹**: ä¸¤çº§é˜²ç„¦ç‚¹ä¿æŠ¤
```python
# Enhanced æ¨¡å¼
await page.evaluate("""
    Object.defineProperty(window, 'focus', {
        value: function() { return false; }
    });
""")

# Basic æ¨¡å¼ï¼ˆè½»é‡çº§ï¼‰
await context.add_init_script(anti_focus_script)
```

**ä»·å€¼**:
- æœ‰å¤´æ¨¡å¼ä¸‹ä¸å¹²æ‰°ç”¨æˆ·å·¥ä½œ
- æ”¯æŒåå°è¿è¡Œ
- å¯é…ç½®çš„é˜²æŠ¤çº§åˆ«


### 4. å®æ—¶çŠ¶æ€æ˜¾ç¤º

**ä½ç½®**: `src/real_time_status.py`

**äº®ç‚¹**: æ— å¤´æ¨¡å¼ä¸‹çš„è¿›åº¦å¯è§†åŒ–
```
ğŸ¤– MS Rewards Automator - å®æ—¶çŠ¶æ€
============================================================
ğŸ“‹ å½“å‰æ“ä½œ: æ‰§è¡Œæ¡Œé¢æœç´¢
ğŸ“Š æ€»ä½“è¿›åº¦: [â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘] 60%
ğŸ–¥ï¸  æ¡Œé¢æœç´¢: 18/30
ğŸ“± ç§»åŠ¨æœç´¢: 0/20
ğŸ’° ç§¯åˆ†è·å¾—: +45
â±ï¸  è¿è¡Œæ—¶é—´: 2åˆ†30ç§’
============================================================
```

**ä»·å€¼**:
- æ— å¤´æ¨¡å¼ä¸‹ä¹Ÿèƒ½äº†è§£è¿›åº¦
- å®æ—¶åé¦ˆæå‡ç”¨æˆ·ä½“éªŒ
- ä¾¿äºç›‘æ§å’Œè°ƒè¯•

---

## ğŸ“ æ€»ç»“ä¸å»ºè®®

### é¡¹ç›®ä¼˜åŠ¿

1. **æ¶æ„è®¾è®¡ä¼˜ç§€** - æ¸…æ™°çš„åˆ†å±‚å’Œæ¨¡å—åŒ–è®¾è®¡
2. **åæ£€æµ‹èƒ½åŠ›å¼º** - å¤šå±‚é˜²æŠ¤ï¼Œæ¨¡æ‹ŸçœŸå®ç”¨æˆ·è¡Œä¸º
3. **æµ‹è¯•è¦†ç›–å®Œå–„** - å•å…ƒã€é›†æˆã€å±æ€§æµ‹è¯•é½å…¨
4. **æ–‡æ¡£è´¨é‡é«˜** - ç”¨æˆ·æŒ‡å—å’Œå¼€å‘è€…æ–‡æ¡£å®Œæ•´
5. **é…ç½®çµæ´»** - ä¸°å¯Œçš„é…ç½®é€‰é¡¹ï¼Œè‡ªåŠ¨éªŒè¯å’Œä¿®å¤


### æ”¹è¿›æ–¹å‘

1. **å®‰å…¨æ€§å¢å¼º** - æ•æ„Ÿä¿¡æ¯åŠ å¯†ï¼Œæ—¥å¿—è„±æ•
2. **æµ‹è¯•å®Œå–„** - æ·»åŠ  E2E æµ‹è¯•ï¼Œé‡åŒ–è¦†ç›–ç‡
3. **æ€§èƒ½ä¼˜åŒ–** - æ‰¹é‡é¢„åŠ è½½ï¼ŒæŒä¹…åŒ–ç¼“å­˜
4. **ä»£ç è´¨é‡** - æ¶ˆé™¤é‡å¤ä»£ç ï¼Œä¼˜åŒ–å¼‚å¸¸å¤„ç†
5. **ç›‘æ§å¢å¼º** - å‘Šè­¦é€šçŸ¥ï¼Œå†å²è¶‹åŠ¿åˆ†æ

### æœ€ç»ˆè¯„ä»·

MS Rewards Automator æ˜¯ä¸€ä¸ªè®¾è®¡ä¼˜ç§€ã€å®ç°å®Œå–„çš„è‡ªåŠ¨åŒ–é¡¹ç›®ã€‚ä»£ç è´¨é‡é«˜ï¼Œæ¶æ„æ¸…æ™°ï¼Œæµ‹è¯•è¦†ç›–å¥½ï¼Œæ–‡æ¡£å®Œæ•´ã€‚ä¸»è¦æ”¹è¿›æ–¹å‘é›†ä¸­åœ¨å®‰å…¨æ€§å¢å¼ºã€æµ‹è¯•å®Œå–„å’Œæ€§èƒ½ä¼˜åŒ–ä¸Šã€‚

**æ¨èæŒ‡æ•°**: â­â­â­â­â˜† (4.2/5.0)

---

## ğŸ“ é™„å½•

### A. æŠ€æœ¯æ ˆ

- **è¯­è¨€**: Python 3.9+
- **æµè§ˆå™¨è‡ªåŠ¨åŒ–**: Playwright 1.40+
- **åæ£€æµ‹**: playwright-stealth
- **æµ‹è¯•æ¡†æ¶**: pytest, hypothesis
- **é…ç½®ç®¡ç†**: PyYAML
- **å¯è§†åŒ–**: Streamlit, Plotly
- **å¼‚æ­¥**: asyncio, aiohttp


### B. ä»£ç ç»Ÿè®¡

```
æ€»æ–‡ä»¶æ•°: 60+
æ€»ä»£ç è¡Œæ•°: ~15,000 è¡Œ

æºç åˆ†å¸ƒ:
  src/core/          ~3,500 è¡Œ (23%)
  src/               ~6,500 è¡Œ (43%)
  tests/             ~4,000 è¡Œ (27%)
  docs/              ~1,000 è¡Œ (7%)

æ¨¡å—ç»Ÿè®¡:
  ç™»å½•æ¨¡å—:          ~1,200 è¡Œ
  æœç´¢æ¨¡å—:          ~2,000 è¡Œ
  ä»»åŠ¡æ¨¡å—:          ~1,500 è¡Œ
  åæ£€æµ‹æ¨¡å—:        ~1,000 è¡Œ
  å¥åº·ç›‘æ§:          ~800 è¡Œ
```

### C. å®¡æŸ¥æ–¹æ³•

æœ¬æ¬¡å®¡æŸ¥é‡‡ç”¨ä»¥ä¸‹æ–¹æ³•:

1. **é™æ€ä»£ç åˆ†æ**
   - ä»£ç ç»“æ„å®¡æŸ¥
   - è®¾è®¡æ¨¡å¼è¯†åˆ«
   - ä»£ç è´¨é‡è¯„ä¼°

2. **åŠ¨æ€åˆ†æ**
   - æµ‹è¯•æ‰§è¡Œåˆ†æ
   - æ€§èƒ½ç“¶é¢ˆè¯†åˆ«
   - èµ„æºä½¿ç”¨è¯„ä¼°

3. **æ–‡æ¡£å®¡æŸ¥**
   - æ–‡æ¡£å®Œæ•´æ€§æ£€æŸ¥
   - ä»£ç æ³¨é‡Šè¯„ä¼°
   - ç”¨æˆ·æŒ‡å—å®¡æŸ¥


4. **å®‰å…¨å®¡æŸ¥**
   - æ•æ„Ÿä¿¡æ¯æ£€æŸ¥
   - è¾“å…¥éªŒè¯è¯„ä¼°
   - ä¾èµ–å®‰å…¨å®¡æŸ¥

### D. å‚è€ƒèµ„æ–™

- [Playwright å®˜æ–¹æ–‡æ¡£](https://playwright.dev/)
- [Python å¼‚æ­¥ç¼–ç¨‹æœ€ä½³å®è·µ](https://docs.python.org/3/library/asyncio.html)
- [pytest æµ‹è¯•æ¡†æ¶](https://docs.pytest.org/)
- [Hypothesis å±æ€§æµ‹è¯•](https://hypothesis.readthedocs.io/)

---

**å®¡æŸ¥äºº**: Kiro AI Assistant  
**å®¡æŸ¥æ—¥æœŸ**: 2026-02-10  
**æŠ¥å‘Šç‰ˆæœ¬**: v1.0  
**ä¸‹æ¬¡å®¡æŸ¥å»ºè®®**: 2026-05-10 (3ä¸ªæœˆå)

